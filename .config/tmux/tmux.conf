# ============================================================================= #
# ~/.config/tmux/tmux.conf                                                      #
# ============================================================================= #


# ============================================================================= #
# TERMINAL SETTINGS                                                             #
# ============================================================================= #
# Enable 256-color and true-color (24-bit) supports in tmux
# Use "tmux-256color" if your terminfo supports it; otherwise fall back to "screen-256color"
set -g default-terminal "screen-256color"
#set -g terminal-overrides ",xterm-256color:RGB"


# ============================================================================= #
# GENERAL SETTINGS                                                              #
# ============================================================================= #
set -g mouse on                                 # Turn on mouse support
set -g set-clipboard on                         # Use system clipboard
set -g detach-on-destroy off                    # Don't exit from tmux when closing a session
set -g base-index 1                             # Windows start at 1
set -g pane-base-index 1                        # Panes start at 1
set -g renumber-windows on                      # Renumber windows on close
set -g focus-events on                          # Let apps (vim/nvim) detect focus changes


# ============================================================================= #
# KEYBINDS                                                                      #
# ============================================================================= #
unbind C-b                                      # Unbind the default prefix key C-b
set -g prefix C-Space                           # Set the new prefix to Ctrl+Space

# Reload the tmux config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Tmux config reloaded"

# Pane navigation (hjkl)
bind-key h select-pane -L                       # Move to left pane
bind-key j select-pane -D                       # Move to bottom pane
bind-key k select-pane -U                       # Move to top pane
bind-key l select-pane -R                       # Move to right pane

# Toggle status bar
bind-key b set-option -g status

# Split panes in current working directory
unbind %
bind \\ split-window -h -c "#{pane_current_path}"
unbind \"
bind - split-window -v -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Resize panes with vim keys
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r m resize-pane -Z 5                      # Toggle maximize pane

# Enable vi mode in copy-mode
set-window-option -g mode-keys vi               # Prefix [ for command mode

# Start selecting text with "v"
bind-key -T copy-mode-vi 'v' send -X begin-selection

# Copy to clipboard with "y"
bind -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# Keep selection when dragging with mouse
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "xclip -selection clipboard"


# ============================================================================= #
# PLUGINS                                                                       #
# ============================================================================= #
set -g @plugin 'tmux-plugins/tpm'               # Tmux plugin manager
set -g @plugin 'christoomey/vim-tmux-navigator' # Pane navigation in vim
set -g @plugin 'tmux-plugins/tmux-resurrect'    # Save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'    # Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-battery'      # Adds battery icon
set -g @plugin 'hendrikmi/tmux-cpu-mem-monitor' # Adds cpu and memory usage icons

# Plugin configuration
set -g @resurrect-capture-pane-contents "on"
set -g @continuum-restore "on"

# Battery plugin icons/colors
set -g @batt_icon_charge_tier8 '󰁹'
set -g @batt_icon_charge_tier7 '󰂂'
set -g @batt_icon_charge_tier6 '󰂁'
set -g @batt_icon_charge_tier5 '󰁿'
set -g @batt_icon_charge_tier4 '󰁽'
set -g @batt_icon_charge_tier3 '󰁻'
set -g @batt_icon_charge_tier2 '󰁺'
set -g @batt_icon_charge_tier1 '󰂎'
set -g @batt_icon_status_charged '󰂄'
set -g @batt_icon_status_charging '󰂊'
set -g @batt_icon_status_discharging '󰂃'
set -g @batt_color_status_primary_charged '#3daee9'
set -g @batt_color_status_primary_charging '#3daee9'


# ============================================================================= #
# THEME/APPEARANCE                                                              #
# ============================================================================= #
bg="#000000"
default_fg="#D8DEE9"
session_fg="#A3BE8C"
session_selection_fg="#3B4252"
session_selection_bg="#81A1C1"
active_window_fg="#88C0D0"
active_pane_border="#ABB2BF"

# Status left
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#[bg=#{?client_prefix,${session_fg},${bg}},fg=#{?client_prefix,${bg},${default_fg}}]  #S #[default]"
set -ga status-left "#[bg=${bg},fg=#{default_fg}]│  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "

# Status right
set -g status-right-length 100
set -g status-right ""
set -g status-right "  #{cpu -i 3} |  #{mem} | #{battery_icon} #{battery_percentage} "

# General status line
set -g status-position bottom
set -g status-justify "absolute-centre"
set -g window-status-current-format "#[fg=${default_fg},bg=default,bold]  #I:#W"
set -g window-status-format "#[fg=${active_pane_border},bg=default] #I:#W"
set -g window-status-last-style "fg=${default_fg},bg=default"
set -g status-style "bg=${bg},fg=${default_fg}"


# Pane borders
set -g pane-active-border-style "fg=${active_pane_border},bg=default"
set -g pane-border-style "fg=brightblack,bg=default"


# ============================================================================= #
# TPM BOOSTRAPING                                                               #
# ============================================================================= #
# Automatic tpm installation
if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
